{"pageContext":{"html":"<h1 id=\"deprecating-resources-and-properties-alternative-to-versioning\"><a href=\"#deprecating-resources-and-properties-alternative-to-versioning\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Deprecating Resources and Properties (Alternative to Versioning)</h1>\n<p>A best practice regarding web APIs development is to apply <a href=\"https://philsturgeon.uk/api/2018/05/02/api-evolution-for-rest-http-apis/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">the evolution strategy</a>\nto indicate to client applications which resource types, operations and fields are deprecated and shouldn't be used anymore.</p>\n<p>While versioning an API requires modifying all clients to upgrade, even the ones not impacted by the changes.\nIt's a tedious task that should be avoided as much as possible.</p>\n<p>On the other hand, the evolution strategy (also known as versionless APIs) consists of deprecating the fields, resources\ntypes or operations that will be removed at some point.</p>\n<p>Most modern API formats including <a href=\"/docs/core/content-negotiation/\">JSON-LD / Hydra</a>, <a href=\"/docs/core/graphql/\">GraphQL</a> and <a href=\"/docs/core/swagger/\">OpenAPI</a>\nallow to mark resources types, operations or fields as deprecated.</p>\n<h2 id=\"deprecating-resource-classes-operations-and-properties\"><a href=\"#deprecating-resource-classes-operations-and-properties\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Deprecating Resource Classes, Operations and Properties</h2>\n<p>When using API Platform, it's easy to mark a whole resource, a specific operation or a specific property as deprecated.\nAll documentation formats mentioned in the introduction will then automatically take the deprecation into account.</p>\n<p>To deprecate a resource class, use the <code class=\"language-text\">deprecationReason</code> attribute:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Entity/Parchment.php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Entity</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">ApiPlatform<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>ApiResource</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @ApiResource(deprecationReason=\"Create a Book instead\")\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Parchment</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>As you can see, to deprecate a resource, we just have to explain what the client should do to upgrade in the dedicated attribute.</p>\n<p>The deprecation will automatically be taken into account by clients supporting the previously mentioned format, including\n<a href=\"/docs/admin/index/\">API Platform Admin</a>, <a href=\"/docs/client-generator/index/\">API Platform Client Generator</a> and the lower level\n<a href=\"https://github.com/api-platform/api-doc-parser\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">api-doc-parser library</a>.</p>\n<p>Here is how it renders for OpenAPI in the built-in Swagger UI shipped with the framework:</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/874b63669db7f3a8000a6ee084fa1b3e/a1db2/deprecated-swagger-ui.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 1120px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 26.550680786686836%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAAAgElEQVQY052QQQ7CMAwE8/8XAhJwb23HSZ1cF9uoiBNqOYxWipxZJ+X+eOJyvWFZVqg21Kqe6lkztbU8/42i+ZyIoOQlZyWCuCSEQe8d22aYcx7GhqGQi4g4iYa9IBrHGKcwcyEzg1lSyF/CIAai+YgsN9yF5MQfvresn6f/I3wB+5d+9QVeNr4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Deprecation shown in Swagger UI\"\n        title=\"\"\n        src=\"/static/874b63669db7f3a8000a6ee084fa1b3e/f066b/deprecated-swagger-ui.png\"\n        srcset=\"/static/874b63669db7f3a8000a6ee084fa1b3e/324c3/deprecated-swagger-ui.png 280w,\n/static/874b63669db7f3a8000a6ee084fa1b3e/53f37/deprecated-swagger-ui.png 560w,\n/static/874b63669db7f3a8000a6ee084fa1b3e/f066b/deprecated-swagger-ui.png 1120w,\n/static/874b63669db7f3a8000a6ee084fa1b3e/a1db2/deprecated-swagger-ui.png 1322w\"\n        sizes=\"(max-width: 1120px) 100vw, 1120px\"\n      />\n  </span>\n  </a></p>\n<p>And now in the built-in version of GraphiQL (for GraphQL APIs):</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8dcaaf2c57f36d71c7b6bfc2fc776fed/af672/deprecated-graphiql.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 426px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 47.652582159624416%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABcklEQVQoz5WR3W6cMBCFef+3SpRIvUulSlGiBTZsAGMbbINhMb+nY+9um4uoTRCfzow8nhkOEWMMnPNA0yjUdQ2lFICd3v2i33iiyY1wRNDJYRx97kKvCzu2bfsyUZprnJhBmitUmURbv6NriOoZVh4w6CLs+HfAv4msSunSG6w6YjlLYFGBfRJYxwqrk9gX/QXozmIRFfE9ePYDLH1EXTyhFS8Q+U8acABmBkwlNc9Ji6Cf4c/g41kiGnsGN4jA2fq4QkefOZ05sBma2pJaUgOsNsRYO6K9xpezfb5umOQGWdkhKQzeEgV56uCoMT/2tLlG38TQ/AgjT7DiFZ2IiQP5mwTt+AuW2YU/7L2Oep1haN/RmwwTbbk6TR42WEaF+VxjcwLzUFIuyVN+xdeJP/kWttOXDVl8B0keVukDmpK8a15Rs18YTEyNy+Bh8HK+6S3+kPuam4edymBNHvBxb07QIqGtfUFD0+vA/j8miY28/A0MPwG+0Ope3QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Deprecation shown in GraphiQL\"\n        title=\"\"\n        src=\"/static/8dcaaf2c57f36d71c7b6bfc2fc776fed/af672/deprecated-graphiql.png\"\n        srcset=\"/static/8dcaaf2c57f36d71c7b6bfc2fc776fed/e2756/deprecated-graphiql.png 280w,\n/static/8dcaaf2c57f36d71c7b6bfc2fc776fed/af672/deprecated-graphiql.png 426w\"\n        sizes=\"(max-width: 426px) 100vw, 426px\"\n      />\n  </span>\n  </a></p>\n<p>You can also use this new <code class=\"language-text\">deprecationReason</code> attribute to deprecate specific <a href=\"/docs/core/operations/\">operations</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Entity/Parchment.php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Entity</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">ApiPlatform<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>ApiResource</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @ApiResource(itemOperations={\n *     \"get\"={\"deprecation_reason\"=\"Retrieve a Book instead\"}\n * })\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Parchment</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>It's also possible to deprecate a single property:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Entity/Review.php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Entity</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">ApiPlatform<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>ApiProperty</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">ApiPlatform<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>ApiResource</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @ApiResource\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Review</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token comment\">/**\n     * @ApiProperty(deprecationReason=\"Use the rating property instead\")\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$letter</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<ul>\n<li>With JSON-lD / Hydra, <a href=\"https://www.w3.org/TR/owl2-syntax/#Annotation_Properties\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">an <code class=\"language-text\">owl:deprecated</code> annotation property</a> will be added to the appropriate data structure</li>\n<li>With Swagger / OpenAPI, <a href=\"https://swagger.io/docs/specification/2-0/paths-and-operations/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">a <code class=\"language-text\">deprecated</code> property</a> will be added</li>\n<li>With GraphQL, the <a href=\"https://facebook.github.io/graphql/June2018/#sec-Deprecation\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">isDeprecated</code> and <code class=\"language-text\">deprecationReason</code> properties</a> will be added to the schema</li>\n</ul>\n<h2 id=\"setting-the-sunset-http-header-to-indicate-when-a-resource-or-an-operation-will-be-removed\"><a href=\"#setting-the-sunset-http-header-to-indicate-when-a-resource-or-an-operation-will-be-removed\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setting the <code class=\"language-text\">Sunset</code> HTTP Header to Indicate When a Resource or an Operation Will Be Removed</h2>\n<p><a href=\"https://tools.ietf.org/html/draft-wilde-sunset-header\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">The <code class=\"language-text\">Sunset</code> HTTP response header</a> indicates that a URI is likely to become unresponsive at a specified point in the future.\nIt is especially useful to indicate when a deprecated URL will not be available anymore.</p>\n<p>Thanks to the <code class=\"language-text\">sunset</code> attribute, API Platform makes it easy to set this header for all URLs related to a resource class:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Entity/Parchment.php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Entity</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">ApiPlatform<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>ApiResource</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @ApiResource(\n *   deprecationReason=\"Create a Book instead\",\n *   sunset=\"01/01/2020\"\n * )\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Parchment</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>The value of the <code class=\"language-text\">sunset</code> attribute can be any string compatible with <a href=\"http://php.net/manual/en/datetime.construct.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">the <code class=\"language-text\">\\DateTime</code> constructor</a>.\nIt will be automatically converted to a valid HTTP date.</p>\n<p>It's also possible to set the <code class=\"language-text\">Sunset</code> header only for a specific <a href=\"/docs/core/operations/\">operation</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Entity/Parchment.php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Entity</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">ApiPlatform<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>ApiResource</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @ApiResource(itemOperations={\n *     \"get\"={\n *         \"deprecation_reason\"=\"Retrieve a Book instead\",\n *         \"sunset\"=\"01/01/2020\"\n *     }\n * })\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Parchment</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>","editPath":"core/deprecations.md","title":"Deprecating Resources and Properties (Alternative to Versioning)","previous":{"slug":"/docs/core/content-negotiation/","title":"Content Negotiation"},"next":{"slug":"/docs/core/performance/","title":"Performance and Cache"}}}